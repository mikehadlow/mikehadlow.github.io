<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Mike Hadlow C# .NET technical blog."><meta name=author content="Mike Hadlow"><meta property="og:url" content="https://mikehadlow.com/posts/2025-05-09-simple-script-for-a-book-review-blog/"><meta property="og:type" content="article"><meta property="og:title" content="Syncing a Google Docs Spreadsheet to a GitHub Hosted Blog"><meta property="og:description" content='Blah
// A Google Apps Script to sync book reviews stored in a Google Docs spreadsheet
// with a Hugo/Markdown based review blog

// GitHub PAT for API access to the repo
const GITHUB_TOKEN = "the-github-pat";

// Path to the repo in GitHub
const REPO_PATH = "joeblogs/bookreviews";

// Name of the sheet
const SHEET_NAME = "Sheet1";

// The ID of the folder containing book images
const FOLDER_ID = "the-spreadsheet-id";

const MAIN_BRANCH = "main";

// The column layout in the spreadsheet
const col = {
  category: 0,
  slug: 1,
  author: 2,
  title: 3,
  subtitle: 4,
  started: 5,
  completed: 6,
  review: 7,
};

// The template for the review front-matter
const template = `+++
title = "{{title}}"
description = "{{subtitle}}"
date = {{completed}}
author = "Mike Hadlow"
[params]
    image = "{{image}}"
    category = "{{category}}"
    book-author = "{{author}}"
    started = "{{started}}"
    completed = "{{completed}}"
    tags = ["book"]
+++
{{review}}
`;

function main() {
  console.log("Starting sync!");
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getSheetByName(SHEET_NAME);
  if (!sheet) {
    Logger.log("Sheet not found: " + SHEET_NAME);
    return;
  }
  const data = sheet.getDataRange().getValues();
  console.log("data.length", data.length);

  // iterate through the rows (reviews) in the sheet looking for any
  // that have a &#39;slug&#39; set.
  for(item of data) {
    const slug = item[col.slug];
    if(slug && slug !== "Slug") {
      const started = new Date(item[col.started]);
      const completed = new Date(item[col.completed]);
      const image = `/img/${slug}.jpg`
      const title = item[col.title]

      // populate the template
      const markdown = template
        .replaceAll("{{image}}", image)
        .replaceAll("{{category}}", item[col.category])
        .replaceAll("{{slug}}", slug)
        .replaceAll("{{author}}", item[col.author])
        .replaceAll("{{title}}", title)
        .replaceAll("{{subtitle}}", item[col.subtitle])
        .replaceAll("{{started}}", started.toISOString().substring(0, 10))
        .replaceAll("{{completed}}", completed.toISOString().substring(0, 10))
        .replaceAll("{{review}}", item[col.review]);
      console.log(markdown);

      pushPostToGitHub(slug, completed, markdown);
      pushPhotoToGithub(slug)
    }
  }
}

function pushPostToGitHub(slug, completed, markdown) {
  const filename = `${completed.toISOString().substring(0, 10)}-${slug}.md`;
  const message = `Add new book review: ${slug}`;
  const content = Utilities.base64Encode(markdown, Utilities.Charset.UTF_8);
  pushToGitHub(filename, content, message, "post");
}

function pushPhotoToGithub(slug) {
  const filename = `${slug}.jpg`;
  const folder = DriveApp.getFolderById(FOLDER_ID);
  const files = folder.getFilesByName(filename);
  if (files.hasNext()) {
    const file = files.next();
    const fileBlob = file.getBlob();
    console.log(`Found file: ${filename} (ID: ${file.getId()})`);
    const content = Utilities.base64Encode(fileBlob.getBytes());
    const message = `Add img for book review: ${filename}`;
    pushToGitHub(filename, content, message, "img");
  }
  else {
    console.log(`Photo not found: ${filename}`)
  }
}

function pushToGitHub(filename, content, message, type) {
  const path = (type === "post") ? "content/posts"
    : (type === "img") ? "static/img"
    : null;
  if(!path) {
    throw new Error(`Unknown pushToGithub type: ${type}`);
  }
  const apiUrl = `https://api.github.com/repos/${REPO_PATH}/contents/${path}/${filename}`;
  const payload = JSON.stringify({
    message,
    content,
    branch: MAIN_BRANCH,
  });

  const headers = {
    "Authorization": `token ${GITHUB_TOKEN}`,
    "Content-Type": "application/json"
  };

  const putOptions = {
    method: "put",
    headers,
    payload,
  };

  const getOptions = {
    method: "get",
    headers,
  }

  try {
    // Return if the file exists
    try {
      const getResponse = UrlFetchApp.fetch(apiUrl, getOptions);
      const status = getResponse.getResponseCode()
      if(status !== 404) {
        console.log(`File already exists: ${status} ${filename}`);
        return;
      }
    } catch (error) {
      console.log(`File ${filename}, not found, safe to proceed with push.`)
    }

    // add the file to the repository
    const response = UrlFetchApp.fetch(apiUrl, putOptions);
    const responseCode = response.getResponseCode();
    const responseText = response.getContentText();

    if (responseCode >= 200 && responseCode < 300) {
      Logger.log(`Successfully pushed file: ${filename}`);
    } else {
      Logger.log(`Error pushing file (${filename}): ${responseCode} - ${responseText}`);
    }
  } catch (error) {
    Logger.log("Error pushing to GitHub: " + error);
  }
}
'><meta property="og:image" content="https://mikehadlow.com/img/blog-image.png"><title>Mike Hadlow</title>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css><link rel=icon href=/favicon.svg type=image/svg+xml></head><body><nav class="navbar is-dark" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a href=/ class=navbar-item><strong>Mike Hadlow</strong>
</a><a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=menu><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=menu class=navbar-menu><div class=navbar-start><a href=https://mikehadlow.com/top/about/ class=navbar-item>About</a>
<a href=https://mikehadlow.com/top/contact/ class=navbar-item>Contact</a>
<a href=https://bsky.app/profile/mikehadlow.com target=_blank rel="noopener noreferrer" class=navbar-item><svg height="24" viewBox="0 0 64 64" width="24" aria-hidden="true"><path fill="#0085ff" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022.0 8.51.0 6.55.0-3.268 8.579-.182 13.873 3.805zm36.254.0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"/></svg>
</a><a href=https://github.com/mikehadlow target=_blank rel="noopener noreferrer" class=navbar-item><svg height="24" viewBox="0 0 16 16" width="24" aria-hidden="true"><path style="fill:#fff" fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-two-thirds"><h1 class=title>Syncing a Google Docs Spreadsheet to a GitHub Hosted Blog</h1><p class=subtitle>By Mike Hadlow, published May 9, 2025</p><div><article id=content class=content><p>Blah</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// A Google Apps Script to sync book reviews stored in a Google Docs spreadsheet
</span></span></span><span style=display:flex><span><span style=color:#75715e>// with a Hugo/Markdown based review blog
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// GitHub PAT for API access to the repo
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>GITHUB_TOKEN</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;the-github-pat&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Path to the repo in GitHub
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>REPO_PATH</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;joeblogs/bookreviews&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Name of the sheet
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>SHEET_NAME</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Sheet1&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The ID of the folder containing book images
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>FOLDER_ID</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;the-spreadsheet-id&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MAIN_BRANCH</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;main&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The column layout in the spreadsheet
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>col</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>category</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>slug</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>author</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subtitle</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>started</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>completed</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>6</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>review</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>7</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The template for the review front-matter
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>template</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`+++
</span></span></span><span style=display:flex><span><span style=color:#e6db74>title = &#34;{{title}}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>description = &#34;{{subtitle}}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>date = {{completed}}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>author = &#34;Mike Hadlow&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[params]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    image = &#34;{{image}}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    category = &#34;{{category}}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    book-author = &#34;{{author}}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    started = &#34;{{started}}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    completed = &#34;{{completed}}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    tags = [&#34;book&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>+++
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{{review}}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Starting sync!&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ss</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SpreadsheetApp</span>.<span style=color:#a6e22e>getActiveSpreadsheet</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sheet</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ss</span>.<span style=color:#a6e22e>getSheetByName</span>(<span style=color:#a6e22e>SHEET_NAME</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>sheet</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Sheet not found: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>SHEET_NAME</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sheet</span>.<span style=color:#a6e22e>getDataRange</span>().<span style=color:#a6e22e>getValues</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;data.length&#34;</span>, <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// iterate through the rows (reviews) in the sheet looking for any
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// that have a &#39;slug&#39; set.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>for</span>(<span style=color:#a6e22e>item</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>slug</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>item</span>[<span style=color:#a6e22e>col</span>.<span style=color:#a6e22e>slug</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>slug</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>slug</span> <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#34;Slug&#34;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>started</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>item</span>[<span style=color:#a6e22e>col</span>.<span style=color:#a6e22e>started</span>]);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>completed</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>item</span>[<span style=color:#a6e22e>col</span>.<span style=color:#a6e22e>completed</span>]);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>image</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`/img/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>slug</span><span style=color:#e6db74>}</span><span style=color:#e6db74>.jpg`</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>title</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>item</span>[<span style=color:#a6e22e>col</span>.<span style=color:#a6e22e>title</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>// populate the template
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>markdown</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>template</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;{{image}}&#34;</span>, <span style=color:#a6e22e>image</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;{{category}}&#34;</span>, <span style=color:#a6e22e>item</span>[<span style=color:#a6e22e>col</span>.<span style=color:#a6e22e>category</span>])
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;{{slug}}&#34;</span>, <span style=color:#a6e22e>slug</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;{{author}}&#34;</span>, <span style=color:#a6e22e>item</span>[<span style=color:#a6e22e>col</span>.<span style=color:#a6e22e>author</span>])
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;{{title}}&#34;</span>, <span style=color:#a6e22e>title</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;{{subtitle}}&#34;</span>, <span style=color:#a6e22e>item</span>[<span style=color:#a6e22e>col</span>.<span style=color:#a6e22e>subtitle</span>])
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;{{started}}&#34;</span>, <span style=color:#a6e22e>started</span>.<span style=color:#a6e22e>toISOString</span>().<span style=color:#a6e22e>substring</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;{{completed}}&#34;</span>, <span style=color:#a6e22e>completed</span>.<span style=color:#a6e22e>toISOString</span>().<span style=color:#a6e22e>substring</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>replaceAll</span>(<span style=color:#e6db74>&#34;{{review}}&#34;</span>, <span style=color:#a6e22e>item</span>[<span style=color:#a6e22e>col</span>.<span style=color:#a6e22e>review</span>]);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>markdown</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pushPostToGitHub</span>(<span style=color:#a6e22e>slug</span>, <span style=color:#a6e22e>completed</span>, <span style=color:#a6e22e>markdown</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pushPhotoToGithub</span>(<span style=color:#a6e22e>slug</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>pushPostToGitHub</span>(<span style=color:#a6e22e>slug</span>, <span style=color:#a6e22e>completed</span>, <span style=color:#a6e22e>markdown</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>filename</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>completed</span>.<span style=color:#a6e22e>toISOString</span>().<span style=color:#a6e22e>substring</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>10</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>slug</span><span style=color:#e6db74>}</span><span style=color:#e6db74>.md`</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`Add new book review: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>slug</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Utilities</span>.<span style=color:#a6e22e>base64Encode</span>(<span style=color:#a6e22e>markdown</span>, <span style=color:#a6e22e>Utilities</span>.<span style=color:#a6e22e>Charset</span>.<span style=color:#a6e22e>UTF_8</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pushToGitHub</span>(<span style=color:#a6e22e>filename</span>, <span style=color:#a6e22e>content</span>, <span style=color:#a6e22e>message</span>, <span style=color:#e6db74>&#34;post&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>pushPhotoToGithub</span>(<span style=color:#a6e22e>slug</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>filename</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>slug</span><span style=color:#e6db74>}</span><span style=color:#e6db74>.jpg`</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>folder</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>DriveApp</span>.<span style=color:#a6e22e>getFolderById</span>(<span style=color:#a6e22e>FOLDER_ID</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>files</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>folder</span>.<span style=color:#a6e22e>getFilesByName</span>(<span style=color:#a6e22e>filename</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>files</span>.<span style=color:#a6e22e>hasNext</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>files</span>.<span style=color:#a6e22e>next</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fileBlob</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>getBlob</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Found file: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>filename</span><span style=color:#e6db74>}</span><span style=color:#e6db74> (ID: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>getId</span>()<span style=color:#e6db74>}</span><span style=color:#e6db74>)`</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Utilities</span>.<span style=color:#a6e22e>base64Encode</span>(<span style=color:#a6e22e>fileBlob</span>.<span style=color:#a6e22e>getBytes</span>());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`Add img for book review: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>filename</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pushToGitHub</span>(<span style=color:#a6e22e>filename</span>, <span style=color:#a6e22e>content</span>, <span style=color:#a6e22e>message</span>, <span style=color:#e6db74>&#34;img&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Photo not found: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>filename</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>pushToGitHub</span>(<span style=color:#a6e22e>filename</span>, <span style=color:#a6e22e>content</span>, <span style=color:#a6e22e>message</span>, <span style=color:#a6e22e>type</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;post&#34;</span>) <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;content/posts&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>:</span> (<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;img&#34;</span>) <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;static/img&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>path</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Unknown pushToGithub type: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>type</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>apiUrl</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`https://api.github.com/repos/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>REPO_PATH</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/contents/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>path</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>filename</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>payload</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>message</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>content</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>branch</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>MAIN_BRANCH</span>,
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>headers</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Authorization&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`token </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>GITHUB_TOKEN</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>putOptions</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;put&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>headers</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>payload</span>,
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getOptions</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;get&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>headers</span>,
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Return if the file exists
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getResponse</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>UrlFetchApp</span>.<span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>apiUrl</span>, <span style=color:#a6e22e>getOptions</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getResponse</span>.<span style=color:#a6e22e>getResponseCode</span>()
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>status</span> <span style=color:#f92672>!==</span> <span style=color:#ae81ff>404</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`File already exists: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>status</span><span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>filename</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`File </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>filename</span><span style=color:#e6db74>}</span><span style=color:#e6db74>, not found, safe to proceed with push.`</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// add the file to the repository
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>UrlFetchApp</span>.<span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>apiUrl</span>, <span style=color:#a6e22e>putOptions</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>responseCode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>getResponseCode</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>responseText</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>getContentText</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>responseCode</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>200</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>responseCode</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>300</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Successfully pushed file: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>filename</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Error pushing file (</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>filename</span><span style=color:#e6db74>}</span><span style=color:#e6db74>): </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>responseCode</span><span style=color:#e6db74>}</span><span style=color:#e6db74> - </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>responseText</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Error pushing to GitHub: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></article></div></div><div class="column is-one-third box"><div class=content><p><strong>Hi, I&rsquo;m Mike Hadlow. Software Engineer, based in Sussex, UK.</strong></p><p>Find my old blog at <a href=http://mikehadlow.blogspot.com/>Code Rant</a>. This ran from 2005 to 2020 and has hundreds of posts.</p><p><em>All code on this blog is published under an <a href=https://opensource.org/licenses/MIT>MIT licence</a>. You are free to copy it and use it for any purpose without attribution. There is no warranty whatsoever. All non-code text is copyright Mike Hadlow and cannot be reused without permission.</em></p><p><strong>There are no cookies on this site</strong></p><p>The GitHub repository for this site is <a href=https://github.com/mikehadlow/mikehadlow.github.io>here</a>.</p></div></div></div></div></section></body><script>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,n=document.getElementById(t);e.classList.toggle("is-active"),n.classList.toggle("is-active")})})})</script></html>