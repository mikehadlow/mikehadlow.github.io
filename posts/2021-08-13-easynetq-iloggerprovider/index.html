<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Mike Hadlow C# .NET technical blog."><meta name=author content="Mike Hadlow"><meta property="og:url" content="https://mikehadlow.com/posts/2021-08-13-easynetq-iloggerprovider/"><meta property="og:type" content="article"><meta property="og:title" content="Register a Microsoft.Extensions.Logging.ILoggerProvider with EasyNetQ"><meta property="og:description" content="EasyNetQ is an opinionated fully featured client API for RabbitMQ. It provides extensive diagnostic logging capabilities via LibLog a logging abstraction that provides support for many common logging libraries. Unfortuntely LigLog doesn&rsquo;t support Microsoft.Extensions.Logging, but this post provides an adaptor, EasyNetQMicrosoftExtensionsLogProvider that will allow EasyNetQ to log to a Microsoft.Extensions.Logging.ILoggerProvider."><meta property="og:image" content="https://mikehadlow.com/img/blog-image.png"><title>Mike Hadlow</title>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css></head><body><nav class="navbar is-dark" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a href=/ class=navbar-item><strong>Mike Hadlow</strong>
</a><a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=menu><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=menu class=navbar-menu><div class=navbar-start><a href=https://mikehadlow.com/top/contact/ class=navbar-item>Contact</a>
<a href=https://bsky.app/profile/mikehadlow.com target=_blank rel="noopener noreferrer" class=navbar-item><svg height="24" viewBox="0 0 64 64" width="24" aria-hidden="true"><path fill="#0085ff" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022.0 8.51.0 6.55.0-3.268 8.579-.182 13.873 3.805zm36.254.0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"/></svg>
</a><a href=https://github.com/mikehadlow target=_blank rel="noopener noreferrer" class=navbar-item><svg height="24" viewBox="0 0 16 16" width="24" aria-hidden="true"><path style="fill:#fff" fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-two-thirds"><h1 class=title>Register a Microsoft.Extensions.Logging.ILoggerProvider with EasyNetQ</h1><p class=subtitle>By Mike Hadlow, published Aug 13, 2021</p><div><article id=content class=content><p><a href=https://easynetq.com/>EasyNetQ</a> is an opinionated fully featured client API for <a href=https://www.rabbitmq.com/>RabbitMQ</a>. It provides extensive diagnostic logging capabilities via <a href=https://github.com/damianh/LibLog>LibLog</a> a logging abstraction that provides support for many common logging libraries. Unfortuntely LigLog doesn&rsquo;t support <code>Microsoft.Extensions.Logging</code>, but this post provides an adaptor, <code>EasyNetQMicrosoftExtensionsLogProvider</code> that will allow EasyNetQ to log to a <code>Microsoft.Extensions.Logging.ILoggerProvider</code>.</p><p>Use it like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>using</span> EasyNetQ;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> EasyNetQ.Logging;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// loggerProvider is your Microsoft.Extensions.Logging.ILoggerProvider</span>
</span></span><span style=display:flex><span>LogProvider.SetCurrentLogProvider(<span style=color:#66d9ef>new</span> EasyNetQMicrosoftExtensionsLogProvider(loggerProvider));
</span></span><span style=display:flex><span><span style=color:#75715e>// Call CreateBus after setting the current log provider</span>
</span></span><span style=display:flex><span>RabbitHutch.CreateBus(..);
</span></span></code></pre></div><p>Copy the code below into a file named <code>EasyNetQMicrosoftExtensionsLogProvider.cs</code> in your project.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>using</span> System;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> EasyNetQ.Logging;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.Extensions.Logging;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> YourNamespace
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EasyNetQMicrosoftExtensionsLogProvider</span> : ILogProvider
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> ILoggerProvider loggerProvider;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> EasyNetQMicrosoftExtensionsLogProvider(ILoggerProvider loggerProvider)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.loggerProvider = loggerProvider ?? <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ArgumentNullException(nameof(loggerProvider));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Logger GetLogger(<span style=color:#66d9ef>string</span> name)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> logger = loggerProvider.CreateLogger(name);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (logLevel, messageFunc, exception, formatParameters) =&gt;
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (messageFunc == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> msLogLevel = logLevel <span style=color:#66d9ef>switch</span> 
</span></span><span style=display:flex><span>                { 
</span></span><span style=display:flex><span>                    EasyNetQ.Logging.LogLevel.Debug =&gt; Microsoft.Extensions.Logging.LogLevel.Debug,
</span></span><span style=display:flex><span>                    EasyNetQ.Logging.LogLevel.Error =&gt; Microsoft.Extensions.Logging.LogLevel.Error,
</span></span><span style=display:flex><span>                    EasyNetQ.Logging.LogLevel.Fatal =&gt; Microsoft.Extensions.Logging.LogLevel.Critical,
</span></span><span style=display:flex><span>                    EasyNetQ.Logging.LogLevel.Info =&gt; Microsoft.Extensions.Logging.LogLevel.Information,
</span></span><span style=display:flex><span>                    EasyNetQ.Logging.LogLevel.Trace =&gt; Microsoft.Extensions.Logging.LogLevel.Trace,
</span></span><span style=display:flex><span>                    EasyNetQ.Logging.LogLevel.Warn =&gt; Microsoft.Extensions.Logging.LogLevel.Warning,
</span></span><span style=display:flex><span>                    _ =&gt; Microsoft.Extensions.Logging.LogLevel.None
</span></span><span style=display:flex><span>                };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> message = messageFunc();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(exception <span style=color:#66d9ef>is</span> Exception)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    logger.Log(msLogLevel, exception, message, formatParameters);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    logger.Log(msLogLevel, message, formatParameters);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>            };
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> IDisposable OpenMappedContext(<span style=color:#66d9ef>string</span> key, <span style=color:#66d9ef>object</span> <span style=color:#66d9ef>value</span>, <span style=color:#66d9ef>bool</span> destructure = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>            =&gt; NullDisposable.Instance;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> IDisposable OpenNestedContext(<span style=color:#66d9ef>string</span> message)
</span></span><span style=display:flex><span>            =&gt; NullDisposable.Instance;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NullDisposable</span> : IDisposable
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>readonly</span> IDisposable Instance = <span style=color:#66d9ef>new</span> NullDisposable();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Dispose()
</span></span><span style=display:flex><span>            { }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></article></div></div><div class="column is-one-third box"><div class=content><p><strong>Hi, I&rsquo;m Mike Hadlow. Software Engineer, based in Sussex, UK.</strong></p><p>Find my old blog at <a href=http://mikehadlow.blogspot.com/>Code Rant</a>. This ran from 2005 to 2020 and has hundreds of posts.</p><p><em>All code on this blog is published under an <a href=https://opensource.org/licenses/MIT>MIT licence</a>. You are free to copy it and use it for any purpose without attribution. There is no warranty whatsoever. All non-code text is copyright Mike Hadlow and cannot be reused without permission.</em></p><p><strong>There are no cookies on this site</strong></p><p>The GitHub repository for this site is <a href=https://github.com/mikehadlow/mikehadlow.github.io>here</a>.</p></div></div></div></div></section></body><script>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,n=document.getElementById(t);e.classList.toggle("is-active"),n.classList.toggle("is-active")})})})</script></html>